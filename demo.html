<!DOCTYPE html>
<html lang="en">
  <head>
    <title>A Gizmo for Cesium Primitive</title>
    <link
      href="https://cdn.jsdelivr.net/npm/cesium@1.92.0/Build/Cesium/Widgets/widgets.min.css"
      rel="stylesheet"
    />
    <script src="https://cdn.jsdelivr.net/npm/cesium@1.92.0/Build/Cesium/Cesium.min.js"></script>
    <style>
      html,
      body,
      #cesiumContainer {
        width: 100%;
        height: 100%;
        margin: 0;
        padding: 0;
        overflow: hidden;
      }

      #toolbar {
        background: rgba(42, 42, 42, 0.8);
        padding: 4px;
        border-radius: 4px;
        position: absolute;
        top: 10px;
        left: 10px;
      }

      #toolbar input {
        vertical-align: middle;
        padding-top: 2px;
        padding-bottom: 2px;
      }

      .actions {
        position: absolute;
        margin: 10px;
        top: 0;
        left: 0;
        z-index: 99;
      }
    </style>
  </head>

  <body>
    <div id="cesiumContainer">
      <div class="actions">
        <button id="translate">Translate</button>
        <button id="rotate">Rotate</button>
        <button id="scale">Scale</button>
      </div>
    </div>
    <script type="module">
      window.CESIUM_BASE_URL =
        "https://cdn.jsdelivr.net/npm/cesium@1.92.0/Build/Cesium";
      import CesiumGizmo from "./src/CesiumGizmo.js";

      Cesium.Ion.defaultAccessToken =
        "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJqdGkiOiI0MjM4NGQ4Yi05MjAzLTQ3NzMtOTZmYS05ZDE1ZWZhYTk3OWMiLCJpZCI6MTEzNTYsInNjb3BlcyI6WyJhc3IiLCJnYyJdLCJpYXQiOjE1NTg2ODcwMDJ9.I0-TpqepRcWIVUUI8KrhoSZp-a70sRSRveNLBXOwOto";

      const viewer = new Cesium.Viewer("cesiumContainer", {
        timeline: false,
        animation: false,
        scene3DOnly: true,
      });

      window._viewer = viewer;
      viewer.scene.globe.depthTestAgainstTerrain = true;

      const orgPos = Cesium.Cartesian3.fromDegrees(120, 31, 50);

      const modelMatrix = Cesium.Transforms.headingPitchRollToFixedFrame(
        orgPos,
        new Cesium.HeadingPitchRoll(0, 0, 0)
      );

      const model = viewer.scene.primitives.add(
        Cesium.Model.fromGltf({
          url: "./model/CesiumBalloon.glb",
          modelMatrix: modelMatrix,
          debugShowBoundingVolume: false,
          scale: 1,
        })
      );
      model.readyPromise.then(() => {
        viewer.camera.setView({
          destination: Cesium.Cartesian3.fromDegrees(120, 30.9995, 100),
          orientation: {
            heading: 0,
            pitch: Cesium.Math.toRadians(-45),
            roll: 0,
          },
        });
      });

      viewer.scene.primitives.add(
        Cesium.Model.fromGltf({
          url: "./model/CesiumBalloon.glb",
          modelMatrix: Cesium.Transforms.headingPitchRollToFixedFrame(
            Cesium.Cartesian3.fromDegrees(120.0001, 31, 50),
            new Cesium.HeadingPitchRoll(Cesium.Math.toRadians(-45), 0, 0)
          ),
          debugShowBoundingVolume: false,
          scale: 2,
        })
      );

      const gizmo = new CesiumGizmo({
        show: true,
        viewer,
        onDragMoving: (res) => {
          console.log(res);
        },
      });

      window._gizmo = gizmo;

      document.getElementById("translate").onclick = () => {
        gizmo.type = CesiumGizmo.Mode.TRANSLATE;
      };

      document.getElementById("rotate").onclick = () => {
        gizmo.type = CesiumGizmo.Mode.ROTATE;
      };

      document.getElementById("scale").onclick = () => {
        gizmo.type = CesiumGizmo.Mode.UNIFORM_SCALE;
      };
    </script>
  </body>
</html>
